<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>QIN Universe</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<style>
@font-face {
    font-family: Soledago;
    src: url("font/Soledago.ttf");
}
@font-face {
    font-family: InriaSans;
    src: url("font/InriaSans-Regular.ttf");
}
@font-face {
    font-family: HipPocket;
    src: url("font/HipPocket.otf");
}
</style>
</head>

<body>
<header>
    <a href="index.html"><img src="img/logo.png" alt="LOGO"> </a>
  <ul>
    <li><a href="characters.html">Персонажи</a></li>
    <li><a href="#">Истории</a></li>
    <li><a href="#">Регионы</a></li>
    <li><a href="#">Виды</a></li>
    <li><a href="#">О вселенной</a></li>
    <li><a href="#">О нас</a></li>
  </ul>
  <a href="like.html"><button id="toggle-cart" class="button">Избранное</button></a>
</header>
<section id="start">
  <p><strong>QIN UNIVERSE</strong> – проект, где каждый персонаж имеет свою историю. Множество регионов
    с уникальными связями, а сюжет соединяет между собой звенья. <br><br>
	Данный сайт собирает в себе всю информацию
    о каждом мире, персонаже, регионе или истории. Данная работа коллективное творчества многих людей и собрала в себе. </p>
</section>
	<section id="info">
    <div class="info-box"><h2>50</h2><p>Персонажей</p></div>
    <div class="info-box"><h2>6</h2><p>Регионов</p></div>
    <div class="info-box"><h2>20</h2><p>Видов</p></div>
    <div class="info-box"><p>Сюжет закончен</p></div>
</section>
<section id="menu">
  <h2>ПЕРСОНАЖИ</h2>
  <div id="menu-items"></div>
</section>
<section id="race">
  <h2>ВИДЫ</h2>
  <div id="race-items"></div>
</section>
<section id="region">
  <h2>РЕГИОНЫ</h2>
  <div id="region-items"></div>
</section>

<section id="contact-form">
    <h2 class="contact-title">ОБРАТНАЯ СВЯЗЬ</h2>
    <div class="contact-wrapper">
      <form class="contact-left">
        <label>Имя</label>
        <input type="text" name="name" placeholder="Александр" required>
        
        <label>Почта</label>
        <input type="email" name="email" placeholder="Aleksandr@gmail.com" required>
        
        <label>Ваше сообщение</label>
        <textarea name="message" placeholder="Мне очень нравится этот проект!!!" required></textarea>
      </form>
      
      <div class="contact-right">
        <p><strong>QIN UNIVERSE</strong> — проект, построенных на людях и их отдаче, так что нам будет приятно услышать ваше мнение, предложения и идеи!</p>
      </div>
    </div>
  </section>
  

<footer class="textcols">
  <div class="textcols-left" style="margin-top: 30px">
    <p>Сайт разработан:<br>
      Калинкиной Александрой<br>
      Волик Алисой<br>
      Петрушиной Евгенией</p>
  </div>
  <div class="textcols-middle" style="margin-top: 30px">
    <p><img src="img/YouTube.png" alt="Изображение"> <img src="img/Tumblr.png" alt="Изображение"> <img src="img/X.png" alt="Изображение"> <img src="img/Telegram App.png" alt="Изображение"> <img src="img/Discord New.png" alt="Изображение"></p>
    <p>*Meta признана экстремистской организацией в России</p>
  </div>
  <div class="textcols-right" style="margin-top: 30px; text-align: right">
    <p>Авторы QIN Universe:<br>
      BlackCube<br>
      ReGulus<br>
      pickle</p>
  </div>
</footer>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabaseUrl = "https://lwrcymzsfwgglbvlkdjs.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3cmN5bXpzZndnZ2xidmxrZGpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1NDg2OTAsImV4cCI6MjA1ODEyNDY5MH0.SPytA4M5Fz61U2c9BIupVNAVNoPuZfYYALNrvZYJzb4";
const supabase = createClient(supabaseUrl, supabaseKey);

function createCard(name, image) {
  return `
    <button class="favorite-btn">
      <svg class="star-icon" viewBox="0 0 24 24">
        <path d="M12 2L15 9h7l-5.5 4.5L18 21l-6-4-6 4 1.5-7.5L2 9h7z" fill="none" stroke="#795CC6" stroke-width="2"/>
      </svg>
    </button>
    <img src="${image || 'https://via.placeholder.com/300x400'}" alt="${name}">
    <div class="rectangle" style="height: 50px;width: 350px;background-color: #795CC6; border-radius: 0px 0px 60px 60px; margin-top:-60px;">
      <p style="margin-top:10px;margin-left:30px;">${name}</p>
    </div>
  `;
}

async function populateFromSupabase(table, nameField, imageField, containerId, linkHref) {
  const container = document.getElementById(containerId);
  const { data, error } = await supabase.from(table).select(`${nameField}, ${imageField}`);

  if (error) {
    console.error(`Ошибка загрузки из таблицы ${table}:`, error);
    return;
  }

  data.forEach(item => {
    const itemDiv = document.createElement("div");
    itemDiv.className = "menu-item";
    itemDiv.innerHTML = createCard(item[nameField], item[imageField]);
    container.appendChild(itemDiv);
  });

  const viewAllLink = document.createElement("a");
  viewAllLink.href = linkHref;
  viewAllLink.className = "view-all";
  viewAllLink.textContent = "Смотреть все";
  container.appendChild(viewAllLink);

  document.querySelectorAll('.favorite-btn').forEach(button => {
    button.addEventListener('click', function () {
      const star = this.querySelector('.star-icon path');
      
      const isFilled = star.getAttribute("fill") !== "none";
      star.setAttribute("fill", isFilled ? "none" : "#795CC6");
      const name = this.nextElementSibling.alt;
      let liked = JSON.parse(localStorage.getItem("likedCharacters") || "[]");
      if (!isFilled) {
        liked.push(name);
      } else {
        liked = liked.filter(i => i !== name);
      }
      localStorage.setItem("likedCharacters", JSON.stringify(liked));
    
    });
  });
}

window.addEventListener('load', () => {
  populateFromSupabase("персонаж", "имя", "изображение", "menu-items", "all-characters.html");
  populateFromSupabase("вид", "название_расы", "изображение", "race-items", "all-races.html");
  populateFromSupabase("регион", "название_региона", "изображение", "region-items", "all-regions.html");
});
</script>
</body>
</html>
